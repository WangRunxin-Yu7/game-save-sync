# é…ç½®çƒ­é‡è½½åŠŸèƒ½æ¼”ç¤º

## ğŸ¬ æ¼”ç¤ºåœºæ™¯

### åœºæ™¯ 1: æ·»åŠ æ–°æ¸¸æˆåˆ°åŒæ­¥åˆ—è¡¨

**æ“ä½œå‰çŠ¶æ€**:
```ini
# data/config.ini
[game:æ¸¸æˆ1ç»¿è‰²ç‰ˆ:1]
path = D:\Games\Game1\saves
allow = *.sav
deny = 
```

**æ“ä½œæ­¥éª¤**:

1. **åº”ç”¨æ­£åœ¨è¿è¡Œä¸­**
   ```
   2025-12-15 10:00:00 app_started
   2025-12-15 10:00:00 config_watcher_started: path=.../data/config.ini
   2025-12-15 10:00:00 timer_start: interval_min=15
   2025-12-15 10:00:00 watch_debounce_start: interval_ms=1500
   ```

2. **æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æ–°æ¸¸æˆ**
   ```ini
   # åœ¨ config.ini æœ«å°¾æ·»åŠ 
   [game:æˆ‘çš„æ–°æ¸¸æˆ:1]
   path = C:\Games\NewGame\SaveData
   allow = *.save;*.dat
   deny = *.tmp
   ```

3. **ä¿å­˜æ–‡ä»¶**

4. **åº”ç”¨è‡ªåŠ¨æ£€æµ‹åˆ°å˜åŒ–å¹¶é‡æ–°åŠ è½½** ï¼ˆ1-3ç§’åï¼‰
   ```
   2025-12-15 10:00:15 config_file_changed: path=.../data/config.ini
   2025-12-15 10:00:15 config_reload_start
   2025-12-15 10:00:16 config_reload_done
   2025-12-15 10:00:16 app_restart
   2025-12-15 10:00:16 backup_game_done: game=æ¸¸æˆ1ç»¿è‰²ç‰ˆ index=1 count=5
   2025-12-15 10:00:16 backup_game_done: game=æˆ‘çš„æ–°æ¸¸æˆ index=1 count=3  ğŸ‘ˆ æ–°æ¸¸æˆ
   2025-12-15 10:00:17 git_pull_ok: path=./repository branch=main
   2025-12-15 10:00:17 watch_debounce_start: interval_ms=1500
   2025-12-15 10:00:17 app_restart_done
   ```

5. **å®Œæˆï¼æ–°æ¸¸æˆå·²å¼€å§‹ç›‘æ§**
   ```
   2025-12-15 10:05:20 watch_event: root=C:\Games\NewGame\SaveData created=1 ...
   2025-12-15 10:05:21 watch_sync_copy_done: root=... game=æˆ‘çš„æ–°æ¸¸æˆ index=1 count=4
   ```

---

### åœºæ™¯ 2: ä¿®æ”¹æ¸¸æˆå­˜æ¡£è·¯å¾„

**æ“ä½œå‰çŠ¶æ€**:
```ini
[game:æ˜Ÿé™…æˆ˜å£«:1]
path = D:\OldPath\StarWarrior\saves
```

**æ“ä½œæ­¥éª¤**:

1. **æ¸¸æˆé‡æ–°å®‰è£…åˆ°æ–°è·¯å¾„**
   - æ—§è·¯å¾„: `D:\OldPath\StarWarrior\saves`
   - æ–°è·¯å¾„: `E:\Games\StarWarrior\SaveData`

2. **ä¿®æ”¹é…ç½®æ–‡ä»¶**
   ```ini
   [game:æ˜Ÿé™…æˆ˜å£«:1]
   path = E:\Games\StarWarrior\SaveData  ğŸ‘ˆ ä¿®æ”¹æ­¤è¡Œ
   ```

3. **ä¿å­˜æ–‡ä»¶**

4. **æŸ¥çœ‹æ—¥å¿—**
   ```
   2025-12-15 10:10:30 config_file_changed: path=.../data/config.ini
   2025-12-15 10:10:30 config_reload_start
   2025-12-15 10:10:31 watcher_remove_path: D:\OldPath\StarWarrior\saves  ğŸ‘ˆ ç§»é™¤æ—§è·¯å¾„
   2025-12-15 10:10:31 watcher_add_path: E:\Games\StarWarrior\SaveData    ğŸ‘ˆ æ·»åŠ æ–°è·¯å¾„
   2025-12-15 10:10:31 backup_game_done: game=æ˜Ÿé™…æˆ˜å£« index=1 count=2
   2025-12-15 10:10:32 app_restart_done
   ```

5. **æ–°è·¯å¾„å·²ç”Ÿæ•ˆï¼Œç»§ç»­ç›‘æ§**

---

### åœºæ™¯ 3: è°ƒæ•´åŒæ­¥ç­–ç•¥

**æ“ä½œå‰**:
```ini
[sync]
poll_interval_minutes = 15
debounce_ms = 1500
```

**éœ€æ±‚**: å¸Œæœ›æ›´é¢‘ç¹åœ°æ£€æŸ¥è¿œç¨‹æ›´æ–°

**æ“ä½œæ­¥éª¤**:

1. **ä¿®æ”¹é…ç½®**
   ```ini
   [sync]
   poll_interval_minutes = 5   ğŸ‘ˆ æ”¹ä¸º 5 åˆ†é’Ÿ
   debounce_ms = 1000          ğŸ‘ˆ å‡å°‘é˜²æŠ–å»¶è¿Ÿ
   ```

2. **ä¿å­˜æ–‡ä»¶**

3. **æŸ¥çœ‹æ—¥å¿—**
   ```
   2025-12-15 10:15:00 config_file_changed: path=.../data/config.ini
   2025-12-15 10:15:00 config_reload_start
   2025-12-15 10:15:01 timer_stop                              ğŸ‘ˆ åœæ­¢æ—§å®šæ—¶å™¨
   2025-12-15 10:15:01 timer_start: interval_min=5             ğŸ‘ˆ å¯åŠ¨æ–°å®šæ—¶å™¨ï¼ˆ5åˆ†é’Ÿï¼‰
   2025-12-15 10:15:01 watch_debounce_stop
   2025-12-15 10:15:01 watch_debounce_start: interval_ms=1000  ğŸ‘ˆ æ–°é˜²æŠ–å»¶è¿Ÿ
   2025-12-15 10:15:01 app_restart_done
   ```

4. **æ–°ç­–ç•¥å·²ç”Ÿæ•ˆ**

---

### åœºæ™¯ 4: å¤šæ¬¡å¿«é€Ÿä¿®æ”¹ï¼ˆé˜²æŠ–æœºåˆ¶ï¼‰

**æ“ä½œæ­¥éª¤**:

1. **è¿ç»­ä¿®æ”¹é…ç½®æ–‡ä»¶ 3 æ¬¡** (æ¯æ¬¡é—´éš” 0.5 ç§’)
   - ç¬¬ 1 æ¬¡: æ·»åŠ æ¸¸æˆ A
   - ç¬¬ 2 æ¬¡: æ·»åŠ æ¸¸æˆ B
   - ç¬¬ 3 æ¬¡: ä¿®æ”¹åŒæ­¥é—´éš”

2. **æŸ¥çœ‹æ—¥å¿—**
   ```
   2025-12-15 10:20:00 config_file_changed: path=.../data/config.ini
   2025-12-15 10:20:00 config_reload_start
   2025-12-15 10:20:00 config_reload_skip: already_restarting  ğŸ‘ˆ ç¬¬2æ¬¡è¢«è·³è¿‡
   2025-12-15 10:20:01 config_reload_skip: already_restarting  ğŸ‘ˆ ç¬¬3æ¬¡è¢«è·³è¿‡
   2025-12-15 10:20:01 app_restart_done
   2025-12-15 10:20:02 config_file_changed: path=.../data/config.ini  ğŸ‘ˆ é‡å¯å®Œæˆåçš„å˜åŒ–
   2025-12-15 10:20:02 config_reload_start
   2025-12-15 10:20:03 app_restart_done                        ğŸ‘ˆ å†æ¬¡é‡å¯ï¼Œåº”ç”¨æœ€ç»ˆé…ç½®
   ```

3. **è¯´æ˜**: 
   - é‡å¯è¿‡ç¨‹ä¸­çš„ä¿®æ”¹ä¼šè¢«è·³è¿‡
   - é‡å¯å®Œæˆåä¼šå†æ¬¡æ£€æµ‹æœ€æ–°é…ç½®
   - æœ€ç»ˆåº”ç”¨çš„æ˜¯æœ€åä¸€æ¬¡ä¿å­˜çš„é…ç½®

---

## ğŸ¯ å®é™…æ“ä½œæ¼”ç¤º

### å‡†å¤‡å·¥ä½œ

1. **å¯åŠ¨æµ‹è¯•è„šæœ¬**
   ```bash
   python test_config_reload.py
   ```

2. **è§‚å¯Ÿè¾“å‡º**
   ```
   ============================================================
   é…ç½®æ–‡ä»¶çƒ­é‡è½½æµ‹è¯•
   ============================================================
   
   åº”ç”¨æ­£åœ¨å¯åŠ¨ï¼Œé…ç½®æ–‡ä»¶çƒ­é‡è½½åŠŸèƒ½å·²å¯ç”¨...
   æç¤º: ä¿®æ”¹ data/config.ini æ–‡ä»¶ï¼Œåº”ç”¨å°†è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®
   æŒ‰ Ctrl+C é€€å‡º
   ============================================================
   
   âœ… åº”ç”¨å·²å¯åŠ¨ï¼Œæ­£åœ¨ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ–...
      é…ç½®æ–‡ä»¶è·¯å¾„: data/config.ini
      è¯·å°è¯•ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ·»åŠ æ¸¸æˆã€ä¿®æ”¹è·¯å¾„ç­‰ï¼‰
   ```

### æµ‹è¯•æ­¥éª¤

#### æµ‹è¯• 1: æ·»åŠ æ¸¸æˆ

1. **æ‰“å¼€ `data/config.ini`**

2. **åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ **:
   ```ini
   [game:æµ‹è¯•æ¸¸æˆ:1]
   path = C:\TestGame\Saves
   allow = *.sav
   deny = 
   ```

3. **ä¿å­˜å¹¶è§‚å¯Ÿæ§åˆ¶å°**

4. **é¢„æœŸè¾“å‡º**:
   ```
   2025-12-15 10:25:00 config_file_changed: path=...
   2025-12-15 10:25:00 config_reload_start
   2025-12-15 10:25:01 backup_game_done: game=æµ‹è¯•æ¸¸æˆ index=1 count=0
   2025-12-15 10:25:01 app_restart_done
   ```

#### æµ‹è¯• 2: ä¿®æ”¹ Git é…ç½®

1. **ä¿®æ”¹é…ç½®æ–‡ä»¶**:
   ```ini
   [git]
   remote = https://github.com/yourname/new-repo.git  ğŸ‘ˆ ä¿®æ”¹ä»“åº“åœ°å€
   branch = develop                                    ğŸ‘ˆ ä¿®æ”¹åˆ†æ”¯
   ```

2. **ä¿å­˜å¹¶è§‚å¯Ÿ**

3. **é¢„æœŸè¾“å‡º**:
   ```
   2025-12-15 10:26:00 config_file_changed: path=...
   2025-12-15 10:26:00 config_reload_start
   2025-12-15 10:26:01 git_instance_create: path=./repository branch=develop remote=https://...
   2025-12-15 10:26:01 repo_ready: ok=True
   2025-12-15 10:26:02 app_restart_done
   ```

#### æµ‹è¯• 3: åˆ é™¤æ¸¸æˆ

1. **ä»é…ç½®æ–‡ä»¶ä¸­åˆ é™¤ä¸€ä¸ªæ¸¸æˆçš„é…ç½®å—**

2. **ä¿å­˜å¹¶è§‚å¯Ÿ**

3. **é¢„æœŸè¾“å‡º**:
   ```
   2025-12-15 10:27:00 config_file_changed: path=...
   2025-12-15 10:27:00 config_reload_start
   2025-12-15 10:27:01 watcher_remove_path: (è¢«åˆ é™¤æ¸¸æˆçš„è·¯å¾„)
   2025-12-15 10:27:01 app_restart_done
   ```

---

## ğŸ“Š æ—¥å¿—è§£è¯»

### æ­£å¸¸é‡è½½æµç¨‹

```
config_file_changed          â†’ æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–
  â†“
config_reload_start          â†’ å¼€å§‹é‡æ–°åŠ è½½é…ç½®
  â†“
watcher_release              â†’ é‡Šæ”¾æ—§çš„æ¸¸æˆç›‘æ§å™¨ï¼ˆå¯é€‰ï¼‰
  â†“
config_reload_done           â†’ é…ç½®é‡æ–°åŠ è½½å®Œæˆ
  â†“
app_restart                  â†’ å¼€å§‹é‡å¯åº”ç”¨æµç¨‹
  â†“
backup_game_done (Ã—N)        â†’ å¤‡ä»½æ‰€æœ‰æ¸¸æˆå­˜æ¡£
  â†“
git_pull_ok                  â†’ æ‹‰å–è¿œç¨‹æ›´æ–°
  â†“
timer_start                  â†’ å¯åŠ¨æ–°å®šæ—¶å™¨
  â†“
watch_debounce_start         â†’ å¯åŠ¨æ–°çš„æ¸¸æˆç›‘æ§
  â†“
app_restart_done             â†’ é‡å¯å®Œæˆ
```

### é‡è½½è¢«è·³è¿‡

```
config_file_changed          â†’ æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–
  â†“
config_reload_skip           â†’ å·²åœ¨é‡å¯ä¸­ï¼Œè·³è¿‡æ­¤æ¬¡é‡è½½
```

### é‡è½½å¤±è´¥

```
config_file_changed          â†’ æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–
  â†“
config_reload_start          â†’ å¼€å§‹é‡æ–°åŠ è½½é…ç½®
  â†“
config_reload_error          â†’ é…ç½®åŠ è½½å¤±è´¥ï¼ˆå¦‚æ ¼å¼é”™è¯¯ï¼‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é…ç½®æ–‡ä»¶æ ¼å¼
ç¡®ä¿é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œå¦åˆ™é‡è½½ä¼šå¤±è´¥ï¼š
```ini
âœ… æ­£ç¡®:
[game:æ¸¸æˆå:1]
path = C:\Path\To\Game

âŒ é”™è¯¯:
[game:æ¸¸æˆå:1
path = C:\Path\To\Game  # ç¼ºå°‘å³æ‹¬å·
```

### 2. è·¯å¾„å­˜åœ¨æ€§
æ·»åŠ æ¸¸æˆæ—¶ï¼Œè·¯å¾„å¯ä»¥æš‚æ—¶ä¸å­˜åœ¨ï¼š
- åº”ç”¨ä¼šè®°å½•è­¦å‘Šæ—¥å¿—
- ä¸ä¼šå¯¼è‡´é‡è½½å¤±è´¥
- è·¯å¾„åˆ›å»ºåä¼šè‡ªåŠ¨å¼€å§‹ç›‘æ§

### 3. é‡è½½æ—¶æœº
å»ºè®®åœ¨ä»¥ä¸‹æ—¶æœºä¿®æ”¹é…ç½®ï¼š
- âœ… åº”ç”¨ç©ºé—²æ—¶
- âœ… æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„ Git æ“ä½œæ—¶
- âš ï¸ é¿å…åœ¨å¤‡ä»½æˆ–æ¨é€è¿‡ç¨‹ä¸­ä¿®æ”¹

### 4. å¤‡ä»½é…ç½®æ–‡ä»¶
ä¿®æ”¹é‡è¦é…ç½®å‰å»ºè®®å¤‡ä»½ï¼š
```bash
cp data/config.ini data/config.ini.bak
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜: ä¿®æ”¹åæ²¡ååº”

**æ£€æŸ¥æ­¥éª¤**:
1. ç¡®è®¤ä¿®æ”¹çš„æ˜¯æ­£ç¡®çš„é…ç½®æ–‡ä»¶
   ```bash
   # æŸ¥çœ‹åº”ç”¨ä½¿ç”¨çš„é…ç½®æ–‡ä»¶è·¯å¾„
   # åœ¨æ—¥å¿—ä¸­æœç´¢: config_watcher_started
   ```

2. æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿˜åœ¨è¿è¡Œ
   ```bash
   # Windows: ä»»åŠ¡ç®¡ç†å™¨
   # Linux: ps aux | grep python
   ```

3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
   ```bash
   # æ‰“å¼€ logs/2025-12-15.log
   # æœç´¢: config_file_changed
   ```

### é—®é¢˜: é‡è½½å¤±è´¥

**å¯èƒ½åŸå› **:
- é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯
- é…ç½®æ–‡ä»¶æƒé™é—®é¢˜
- ç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ³•**:
1. éªŒè¯ INI æ ¼å¼
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### æ‰¹é‡æ·»åŠ æ¸¸æˆ

1. **å‡†å¤‡é…ç½®å—**
   ```ini
   [game:æ¸¸æˆ1:1]
   path = C:\Games\Game1\Saves
   allow = *.sav
   deny = 
   
   [game:æ¸¸æˆ2:1]
   path = C:\Games\Game2\SaveData
   allow = *.save;*.dat
   deny = *.tmp
   ```

2. **ä¸€æ¬¡æ€§ç²˜è´´åˆ°é…ç½®æ–‡ä»¶**

3. **ä¿å­˜ä¸€æ¬¡å³å¯** - åº”ç”¨ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ–°æ¸¸æˆ

### ä¸´æ—¶ç¦ç”¨æ¸¸æˆç›‘æ§

å°†æ¸¸æˆé…ç½®æ³¨é‡Šæ‰å³å¯ï¼š
```ini
# [game:æš‚æ—¶ä¸ç©çš„æ¸¸æˆ:1]
# path = C:\Games\...
# allow = *.sav
# deny = 
```

ä¿å­˜ååº”ç”¨ä¼šåœæ­¢ç›‘æ§è¯¥æ¸¸æˆã€‚

### å¿«é€Ÿåˆ‡æ¢é…ç½®

å‡†å¤‡å¤šä¸ªé…ç½®æ–‡ä»¶ï¼š
```
config.ini        # å½“å‰ä½¿ç”¨
config.gaming.ini # æ¸¸æˆæ¨¡å¼
config.work.ini   # å·¥ä½œæ¨¡å¼
```

éœ€è¦åˆ‡æ¢æ—¶ï¼š
```bash
# å¤‡ä»½å½“å‰é…ç½®
mv config.ini config.current.ini
# ä½¿ç”¨æ–°é…ç½®
cp config.gaming.ini config.ini
# åº”ç”¨è‡ªåŠ¨é‡è½½ âœ…
```

---

## ğŸ‰ æ€»ç»“

é…ç½®çƒ­é‡è½½åŠŸèƒ½è®©æ¸¸æˆå­˜æ¡£åŒæ­¥æ›´åŠ æ–¹ä¾¿ï¼š
- âœ… æ— éœ€æ‰‹åŠ¨é‡å¯åº”ç”¨
- âœ… é…ç½®ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
- âœ… æ“ä½œç®€å•ç›´è§‚
- âœ… å®‰å…¨å¯é 

å°½æƒ…äº«å—æ— ç¼çš„é…ç½®ç®¡ç†ä½“éªŒå§ï¼ğŸš€

---

**ç›¸å…³æ–‡æ¡£**:
- [é…ç½®çƒ­é‡è½½æŒ‡å—](CONFIG_RELOAD_GUIDE.md)
- [æ›´æ–°æ—¥å¿—](CHANGELOG.md)
- [å¿«é€Ÿå‚è€ƒ](QUICK_REFERENCE.md)
